<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - Discuss</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìñ</text></svg>">
    
    <style>
        .reader-layout { display: grid; grid-template-columns: 1fr 350px; gap: 20px; margin-top: 20px; }
        .clean-article-card { background: white; border-radius: 12px; padding: 40px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); line-height: 1.8; font-size: 1.15rem; }
        .clean-article-card h2 { color:#764ba2; margin-bottom: 20px; }
        .article-body { color: #333; margin-top: 25px; white-space: pre-wrap; }
        .pulse-sidebar { position: sticky; top: 20px; height: fit-content; }
        .ai-interaction-card { background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%); border: 1px solid #ddd; border-radius: 12px; padding: 20px; display: flex; flex-direction: column; min-height: 450px; }
        .pulse-status { font-weight: bold; color: #764ba2; margin-bottom: 15px; display: block; }
        .thinking-bubble {
                    display: none;
                    align-self: flex-start;
                    background: #f1f1f1;
                    color: #888;
                    padding: 8px 15px;
                    border-radius: 15px;
                    font-size: 0.85rem;
                    margin: 5px 0;
                    font-style: italic;
                    animation: pulse 1.5s infinite;
                }

                @keyframes pulse {
                    0% { opacity: 0.5; }
                    50% { opacity: 1; }
                    100% { opacity: 0.5; }
                }
        #ai-text-output { font-style: normal; color: #444; margin-bottom: 10px; line-height: 1.5; font-size: 0.95rem; }
        @media (max-width: 1000px) { .reader-layout { grid-template-columns: 1fr; } .pulse-sidebar { position: static; } }
        
        /* Button Styling */
        .perm-btn-yes { background: #764ba2; color: white; border: none; padding: 10px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; flex: 1; }
        .perm-btn-no { background: #eee; color: #444; border: none; padding: 10px 15px; border-radius: 20px; cursor: pointer; flex: 1; }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <nav class="navbar">
            <div class="nav-header">
                <h1 class="nav-logo" style="cursor:pointer" onclick="window.location.href='/dashboard'">Discuss</h1>
                <div class="nav-user">
                    <a href="{{ url_for('dashboard') }}" class="logout-btn" style="background: #666;">‚Üê Back to Feed</a>
                </div>
            </div>
        </nav>

        <div class="main-content">
            <div class="reader-layout">
                <main class="clean-article-card">
                    <header class="content-header" style="padding:0; border:none; margin-bottom:20px;">
                        <h2 style="font-size: 2rem; margin-bottom: 10px;">{{ title }}</h2>
                        <a href="{{ source_url }}" target="_blank" class="news-source">Original Source ‚Üó</a>
                    </header>
                    {% if image %}<img src="{{ image }}" alt="Article Image" style="width:100%; border-radius:8px; margin-bottom:20px;">{% endif %}
                    <div class="article-body" id="article-text-content">{{ content }}</div>
                </main>

                <aside class="pulse-sidebar">
    <div class="ai-interaction-card">
        <span class="pulse-status">‚ö° Discuss Insight</span>
        
        <div id="chat-container" style="flex-grow: 1; overflow-y: auto; margin-bottom: 15px; padding: 10px; background: rgba(255,255,255,0.7); border-radius: 8px; border: 1px solid #eee; display: flex; flex-direction: column;">
            
            <div id="ai-text-output">
                "Ready to break this down. Tap below to start."
            </div>

            <div id="permission-zone" style="display:none; gap: 8px; margin-top: 15px;">
                <button class="perm-btn-yes" onclick="startFullDiscussion()">Yes, let's discuss!</button>
                <button class="perm-btn-no" onclick="cancelDiscussion()">No, thanks.</button>
            </div>

            <div id="thinking-indicator" class="thinking-bubble" style="display:none;">Discuss is thinking...</div>
        </div>

        <div id="interaction-zone" style="display:none; margin-top: auto; border-top: 1px solid #eee; padding-top: 15px; margin-bottom: 10px;">
            <div style="display: flex; gap: 8px; align-items: center;">
                <input type="text" id="user-chat-input" placeholder="Ask follow-up..." 
                       style="flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ddd; outline: none;">
                <button onclick="startVoiceInput()" style="background:none; border:none; font-size: 1.2rem; cursor:pointer;">üé§</button>
                <button onclick="sendFollowUp()" style="background:#764ba2; color:white; border:none; border-radius: 50%; width: 35px; height: 35px; cursor:pointer; display: flex; align-items: center; justify-content: center;">‚ûî</button>
            </div>
        </div>

        <button class="mentor-btn" id="trigger-pulse" onclick="runReaderAnalysis()" style="width: 100%;">
            Start Discussion
        </button>

        <button id="stop-voice" onclick="stopSpeaking()" 
                style="display:none; width: 100%; background:#ff4b2b; color:white; border:none; padding: 12px; border-radius: 8px; margin-top: 10px; font-weight: bold; cursor: pointer;">
            üõë STOP DISCUSSION
        </button>
    </div>
</aside>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    
</body>
</html>